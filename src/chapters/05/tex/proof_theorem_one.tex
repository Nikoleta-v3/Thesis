\begin{proof}

It was discussed that \(u_q(p)\) it is the product of the steady state
vector \(v\) and the PD payoffs,

\[u_q(p) = v \cdot (R, S, T, P).\]

The dot product of \(v \cdot (R, S, T, P)\) gives,

\begingroup
\scriptsize
\begin{equation*}
    \resizebox{0.91\hsize}{!}{
    $u_q(p) = \left(
    \frac
        {\parbox{6in}{$ - p_{1} p_{2} (q_{1} - q_{3}) (P q_{2} - P - T q_{4}) + p_{1} p_{3} (q_{1} - q_{2}) (P q_{3} - S q_{4}) + p_{1} p_{4} (q_{1} - q_{4}) (S q_{2} - S - T q_{3}) + p_{2} p_{3} (q_{2} - q_{3}) (P q_{1} - P - R q_{4}) - $ \\
        $ p_{2} p_{4} (q_{3} - q_{4}) (R q_{2} - R - T q_{1} + T) + p_{3} p_{4} (q_{2} - q_{4}) (R q_{3} - S q_{1} + S) + p_{1} q_{1} (P q_{2} - P - T q_{4}) - p_{2} (q_{3} - 1) (P q_{2} - P - T q_{4}) + $ \\
        $ p_{3} (- P q_{1} q_{2} + P q_{2} q_{3} + P q_{2} - P q_{3} + R q_{2} q_{4} - S q_{2} q_{4} + S q_{4}) + p_{4} (- R q_{2} q_{4} + R q_{4} + S q_{2} q_{4} - S q_{2} - S q_{4} + S ) $ \\
        \hspace*{5cm} $ T q_{1} q_{4} - T q_{3} q_{4} + T q_{3} - T q_{4} - P q_{2} + P + T q_{4}$
        }}
        {\parbox{6in}{$
        p_{1} p_{2} (q_{1} q_{2} - q_{1} q_{4} - q_{1} - q_{2} q_{3} + q_{3} q_{4} + q_{3}) + p_{1} p_{3} (- q_{1} q_{3} + q_{1} q_{4} + q_{2} q_{3} - q_{2} q_{4}) + p_{1} p_{4} (- q_{1} q_{2} + q_{1} q_{3} + q_{1} + q_{2} q_{4} - q_{3} q_{4} - q_{4}) +$ \\
        $ p_{2} p_{3} (- q_{1} q_{2} + q_{1} q_{3} + q_{2} q_{4} + q_{2} - q_{3} q_{4} - q_{3}) + p_{2} p_{4} (- q_{1} q_{3} + q_{1} q_{4} + q_{2} q_{3} - q_{2} q_{4}) + p_{3} p_{4} (q_{1} q_{2} - q_{1} q_{4} - q_{2} q_{3} - q_{2} + q_{3} q_{4} + q_{4}) + $ \\
        $ p_{1} (- q_{1} q_{2} + q_{1} q_{4} + q_{1}) + p_{2} (q_{2} q_{3} - q_{2} - q_{3} q_{4} - q_{3} + q_{4} + 1) + p_{3} (q_{1} q_{2} - q_{2} q_{3} - q_{2} + q_{3} - q_{4}) + p_{4} (- q_{1} q_{4} + q_{2} + q_{3} q_{4} - q_{3} + q_{4} - 1) + $ \\
        \hspace*{7cm} $q_{2} - q_{4} - 1$
    }}
    \right).$}
\end{equation*}
    \endgroup

Consider the numerator of \(u_q(p)\). The cross product terms \(p_ip_j\) are
given by,

\begingroup
\footnotesize
\begin{align*}
- p_{1} p_{2} (q_{1} - q_{3}) (P q_{2} - P - T q_{4}) + p_{1} p_{3} (q_{1} - q_{2}) (P q_{3} - S q_{4}) + p_{1} p_{4} (q_{1} - q_{4}) (S q_{2} - S - T q_{3}) + \\
p_{2} p_{3} (q_{2} - q_{3}) (P q_{1} - P - R q_{4}) - p_{2} p_{4} (q_{3} - q_{4}) (R q_{2} - R - T q_{1} + T) + p_{3} p_{4} (q_{2} - q_{4}) (R q_{3} - S q_{1} + S)
\end{align*}
\endgroup

This can be re written in a matrix format given by
Equation~(\ref{eq:cross_product_coeffs}).

\begin{equation}\label{eq:cross_product_coeffs}
    \resizebox{0.9\linewidth}{!}{\arraycolsep=2.5pt%
    \boldmath\(
    (p_1, p_2, p_3, p_4) \frac{1}{2} \input{src/chapters/05/paper/memory-size-in-the-prisoners-dilemma/tex/q_numerator} \begin{pmatrix}
    p_1 \\
    p_2 \\
    p_3 \\
    p_4 \end{pmatrix}
    \) }
\end{equation}

Similarly, the linear terms are given by,

\begingroup
\footnotesize
\begin{align*}
p_{1} q_{1} & (P q_{2} - P - T q_{4}) + p_{4} (- R q_{2} q_{4} + R q_{4} + S q_{2} q_{4} - S q_{2} - S q_{4} + S + T q_{1} q_{4} - T q_{3} q_{4} + T q_{3} - T q_{4})\\
- p_{2} & (q_{3} - 1) (P q_{2} - P - T q_{4}) + p_{3} (- P q_{1} q_{2} + P q_{2} q_{3} + P q_{2} - P q_{3} + R q_{2} q_{4} - S q_{2} q_{4} + S q_{4})
\end{align*}
\endgroup

and the expression can be written using a matrix format as
Equation~(\ref{eq:linear_coeffs}).

\begin{equation}\label{eq:linear_coeffs}
    \resizebox{0.7\linewidth}{!}{\arraycolsep=2.5pt%
    \boldmath\(
    (p_1, p_2, p_3, p_4) \input{src/chapters/05/paper/memory-size-in-the-prisoners-dilemma/tex/c_numerator}\)}
\end{equation}

Finally, the constant term of the numerator, which is obtained by
substituting $p=(0, 0, 0, 0)$, is given by Equation~(\ref{eq:constant}).

\begin{equation}\label{eq:constant}
- P q_{2} + P + T q_{4}
\end{equation}

Combining Equation~(\ref{eq:cross_product_coeffs}), Equation~(\ref{eq:linear_coeffs}) and
Equation~(\ref{eq:constant}) gives that the numerator of \(u_q(p)\) can be written
as,

\begingroup
\boldmath
\begin{equation*}
\resizebox{0.9\textwidth}{!}{$ \begin{split}
    \frac{1}{2}p & \input{src/chapters/05/paper/memory-size-in-the-prisoners-dilemma/tex/q_numerator} p^T +  \\
    & \input{src/chapters/05/paper/memory-size-in-the-prisoners-dilemma/tex/c_numerator} p - P q_{2} + P + T q_{4}
\end{split} $}
\end{equation*}
\endgroup

and equivalently as,

\[\frac{1}{2}pQp^T + cp + a\]

where \(Q\) \(\in \R^{4\times4}\) is a square matrix defined by the
transition probabilities of the opponent \(q_1, q_2, q_3, q_4\) as follows:

\begin{equation*}
    \resizebox{0.9\linewidth}{!}{\arraycolsep=2.5pt%
    \boldmath\(
    Q = \input{src/chapters/05/paper/memory-size-in-the-prisoners-dilemma/tex/q_numerator}\)},
\end{equation*}

\(c\) \(\in \R^{4 \times 1}\) is similarly defined by:

\begin{equation*}
    \resizebox{0.6\linewidth}{!}{\arraycolsep=2.5pt%
    \boldmath\(c = \input{src/chapters/05/paper/memory-size-in-the-prisoners-dilemma/tex/c_numerator}\),}
\end{equation*}

and \(a = \input{src/chapters/05/paper/memory-size-in-the-prisoners-dilemma/tex/numerator_constant}\).

The same process is done for the denominator.
\end{proof}