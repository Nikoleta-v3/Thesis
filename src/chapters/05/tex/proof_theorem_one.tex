\begin{proof} The utility of a memory-one player \(p\) against a memory-one
opponent \(q\) is given by Equation (\ref{eq:press_dyson_utility}).
Substituting \((R, P, S, T) = (3, 1, 0, 5)\) in (\ref{eq:press_dyson_utility})
gives,

\begingroup
\footnotesize
\begin{equation}
    \resizebox{.9\linewidth}{!}{
    $
    u_q(p) =
    \left(
        \frac
        {\parbox{6in}{$
            p_{1} p_{2} (q_{1} q_{2} - 5 q_{1} q_{4} - q_{1} - q_{2} q_{3} + 5 q_{3} q_{4} + q_{3}) + p_{1} p_{3} (- q_{1} q_{3} + q_{2} q_{3}) + p_{1} p_{4} (5 q_{1} q_{3} - 5 q_{3} q_{4}) + p_{3} p_{4} (- 3 q_{2} q_{3} + 3 q_{3} q_{4}) +$ \\
            \hspace*{1cm} $ p_{2} p_{3} (- q_{1} q_{2} + q_{1} q_{3} + 3 q_{2} q_{4} + q_{2} - 3 q_{3} q_{4} - q_{3}) + p_{2} p_{4} (- 5 q_{1} q_{3} + 5 q_{1} q_{4} + 3 q_{2} q_{3} - 3 q_{2} q_{4} + 2 q_{3} - 2 q_{4}) + $ \\
            \hspace*{1cm} $ p_{1} (- q_{1} q_{2} + 5 q_{1} q_{4} + q_{1}) + p_{2} (q_{2} q_{3} - q_{2} - 5 q_{3} q_{4} - q_{3} + 5 q_{4} + 1) + p_{3} (q_{1} q_{2} - q_{2} q_{3} - 3 q_{2} q_{4} - q_{2} + q_{3}) +$ \\
            \hspace*{4cm} $ p_{4} (- 5 q_{1} q_{4} + 3 q_{2} q_{4} + 5 q_{3} q_{4} - 5 q_{3} + 2 q_{4}) + q_{2} - 5 q_{4} - 1$
        }}
        {\parbox{6in}{$
        p_{1} p_{2} (q_{1} q_{2} - q_{1} q_{4} - q_{1} - q_{2} q_{3} + q_{3} q_{4} + q_{3}) + p_{1} p_{3} (- q_{1} q_{3} + q_{1} q_{4} + q_{2} q_{3} - q_{2} q_{4}) + p_{1} p_{4} (- q_{1} q_{2} + q_{1} q_{3} + q_{1} + q_{2} q_{4} - q_{3} q_{4} - q_{4}) +$ \\
        $ p_{2} p_{3} (- q_{1} q_{2} + q_{1} q_{3} + q_{2} q_{4} + q_{2} - q_{3} q_{4} - q_{3}) + p_{2} p_{4} (- q_{1} q_{3} + q_{1} q_{4} + q_{2} q_{3} - q_{2} q_{4}) + p_{3} p_{4} (q_{1} q_{2} - q_{1} q_{4} - q_{2} q_{3} - q_{2} + q_{3} q_{4} + q_{4}) + $ \\
        $ p_{1} (- q_{1} q_{2} + q_{1} q_{4} + q_{1}) + p_{2} (q_{2} q_{3} - q_{2} - q_{3} q_{4} - q_{3} + q_{4} + 1) + p_{3} (q_{1} q_{2} - q_{2} q_{3} - q_{2} + q_{3} - q_{4}) + p_{4} (- q_{1} q_{4} + q_{2} + q_{3} q_{4} - q_{3} + q_{4} - 1) + $ \\
        \hspace*{7cm} $q_{2} - q_{4} - 1$
        }}
    \right).
    $}
\end{equation}
\endgroup

Let us consider the numerator of the \(u_q(p)\). The cross product terms \(p_ip_j\)
are given by,

\begingroup
\footnotesize
\begin{align*}
p_{1} p_{2} (q_{1} q_{2} - 5 q_{1} q_{4} - q_{1} - q_{2} q_{3} + 5 q_{3} q_{4}
+ q_{3}) + p_{1} p_{3} (- q_{1} q_{3} + q_{2} q_{3}) + p_{1} p_{4} (5 q_{1} q_{3} -
5 q_{3} q_{4}) + p_{3} p_{4} (- 3 q_{2} q_{3} + 3 q_{3} q_{4}) +  \\
p_{2} p_{3} (- q_{1} q_{2} + q_{1} q_{3} + 3 q_{2} q_{4} + q_{2} - 3 q_{3} q_{4} - q_{3}) +
p_{2} p_{4} (- 5 q_{1} q_{3} + 5 q_{1} q_{4} + 3 q_{2} q_{3} - 3 q_{2} q_{4} +
2 q_{3} - 2 q_{4}).
\end{align*}
\endgroup

This can be re written in a matrix format given by (\ref{eq:cross_product_coeffs}).

\begin{equation}\label{eq:cross_product_coeffs}
    \resizebox{0.9\linewidth}{!}{
    \boldmath\( 
    (p_1, p_2, p_3, p_4) \frac{1}{2} \input{src/chapters/05/paper/memory-size-in-the-prisoners-dilemma/tex/q_numerator} \begin{pmatrix} 
    p_1 \\
    p_2 \\
    p_3 \\
    p_4 \end{pmatrix}
    \) }
\end{equation}

Similarly, the linear terms are given by,

\begingroup
\footnotesize
\begin{align*}
p_{1} (- q_{1} q_{2} + 5 q_{1} q_{4} + q_{1}) + p_{2} (q_{2} q_{3} - q_{2} - 5 q_{3} q_{4} - q_{3} + 5 q_{4} + 1) + p_{3} (q_{1} q_{2} - q_{2} q_{3} - 3 q_{2} q_{4} - q_{2} + q_{3}) + \\
p_{4} (- 5 q_{1} q_{4} + 3 q_{2} q_{4} + 5 q_{3} q_{4} - 5 q_{3} + 2 q_{4}).
\end{align*}
\endgroup

and the expression can be written using a matrix format as (\ref{eq:linear_coeffs}).

\begin{equation}\label{eq:linear_coeffs}
    \resizebox{0.4\linewidth}{!}{
    \boldmath\(
    (p_1, p_2, p_3, p_4) \input{src/chapters/05/paper/memory-size-in-the-prisoners-dilemma/tex/c_numerator}\)}
\end{equation}

Finally, the constant term of the numerator, which is obtained by substituting
$p=(0, 0, 0, 0)$, is given by (\ref{eq:constant}).

\begin{equation}\label{eq:constant}
q_{2} - 5 q_{4} - 1
\end{equation}

Combining equations (\ref{eq:cross_product_coeffs}), (\ref{eq:linear_coeffs}) and (\ref{eq:constant})
gives that the numerator of \(u_q(p)\) can be written as,

\begingroup
\tiny\boldmath
\begin{align*}
    \frac{1}{2}p & \input{src/chapters/05/paper/memory-size-in-the-prisoners-dilemma/tex/q_numerator} p^T +  \\
    & \input{src/chapters/05/paper/memory-size-in-the-prisoners-dilemma/tex/q_numerator} p  \\ 
    & + q_{2} - 5 q_{4} - 1
\end{align*}
\endgroup

and equivalently as,

\[\frac{1}{2}pQp^T + cp + a\]

where \(Q\) \(\in \R^{4\times4}\) is a square matrix defined by the
transition probabilities of the opponent \(q_1, q_2, q_3, q_4\) as follows:

\begin{equation*}
    \resizebox{\linewidth}{!}{
    \boldmath\(
    Q = \input{src/chapters/05/paper/memory-size-in-the-prisoners-dilemma/tex/q_numerator}\)},
\end{equation*}

\(c\) \(\in \R^{4 \times 1}\) is similarly defined by:

\begin{equation*}
    \resizebox{0.4\linewidth}{!}{\arraycolsep=2.5pt%
    \boldmath\(c = \input{src/chapters/05/paper/memory-size-in-the-prisoners-dilemma/tex/c_numerator}\),}
\end{equation*}

and \(a = \input{src/chapters/05/paper/memory-size-in-the-prisoners-dilemma/tex/numerator_constant}\).

The same process is done for the denominator.
\end{proof}